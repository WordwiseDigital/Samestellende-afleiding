<!doctype html>
<html lang="af">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Samestellende Afleiding ‚Ä¢ Graad 8 FAL</title>
  <style>
    :root{ --bg:#0f172a; --card:#111827; --ink:#f8fafc; --muted:#cbd5e1; --accent:#22d3ee; --good:#22c55e; --bad:#ef4444; }
    *{box-sizing:border-box}
    body{ margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial; background:linear-gradient(160deg,#0b1025,#121a3a 60%,#0b1025); color:var(--ink); }
    header{padding:18px 20px;border-bottom:1px solid #1f2937;display:flex;gap:14px;align-items:center;flex-wrap:wrap}
    header h1{margin:0;font-size:20px;font-weight:700}
    header .tag{font-size:12px;color:var(--muted);padding:2px 8px;border:1px solid #334155;border-radius:999px}
    #app{max-width:1100px;margin:18px auto 64px;padding:0 16px}
    .nav{display:flex;flex-wrap:wrap;gap:10px;margin:16px 0 20px}
    .nav button{ background:#111827;border:1px solid #273143;color:var(--ink);padding:10px 14px;border-radius:12px;cursor:pointer;font-weight:600;transition:.15s transform ease }
    .nav button:active{transform:scale(0.98)} .nav button.active{border-color:var(--accent);box-shadow:0 0 0 2px #0ea5b8 inset}
    .card{ background:linear-gradient(180deg,#0b1227,#0b0f1f); border:1px solid #1f2937; border-radius:16px; padding:18px; box-shadow:0 10px 30px rgba(0,0,0,.35) }
    h2{margin:0 0 12px;font-size:22px} p{color:var(--muted);line-height:1.6}
    .grid{display:grid;gap:14px} @media(min-width:860px){.grid.cols-2{grid-template-columns:1fr 1fr}}
    .pill{display:inline-block;padding:6px 10px;border:1px dashed #334155;border-radius:10px;color:#93c5fd;font-size:13px;margin-right:6px}
    .hl{color:#67e8f9} .muted{color:var(--muted);font-size:14px} .hint{color:#a1a1aa;font-style:italic;font-size:13px;margin:.2rem 0 .6rem}
    .btn{background:#0b1227;border:1px solid #334155;color:var(--ink);padding:8px 12px;border-radius:10px;cursor:pointer;transition:.15s transform ease}
    .btn:active{transform:scale(0.98)} .btn.primary{border-color:var(--accent);box-shadow:0 0 0 2px #0ea5b8 inset}
    .kpi{display:flex;gap:8px;align-items:center;padding:8px 10px;border:1px solid #273143;border-radius:12px}
    .sep{height:1px;background:#1f2937;margin:14px 0}
    footer{max-width:1100px;margin:28px auto 40px;padding:0 16px;color:#94a3b8;font-size:12px;text-align:center}
    /* Drag & Drop */
    .dragbank,.buckets{display:flex;gap:10px;flex-wrap:wrap}
    .chip{ padding:8px 10px;border:1px solid #334155;border-radius:12px;background:#0f172a;cursor:grab;user-select:none;display:inline-flex;gap:6px;align-items:center }
    .chip.good{ border-color:var(--good); box-shadow:0 0 0 2px rgba(34,197,94,.2) inset }
    .chip.bad{ border-color:var(--bad); box-shadow:0 0 0 2px rgba(239,68,68,.25) inset }
    .chip .mark{font-size:12px;opacity:.9}
    .bucket{ min-height:64px;flex:1;padding:10px;border:2px dashed #334155;border-radius:12px;background:#0b0f1f }
    .bucket h4{margin:0 0 6px;font-size:14px;color:#a5b4fc}
    .bucket.correct{border-color:var(--good)} .bucket.wrong{border-color:var(--bad)}
    /* MCQ */
    .mcq{margin-bottom:12px}
    .mcq .qhead{display:flex;align-items:center;gap:8px}
    .mcq .status{font-size:12px}
    .mcq .option{padding:10px;border:1px solid #334155;border-radius:12px;cursor:pointer;margin:8px 0;display:flex;justify-content:space-between;align-items:center}
    .mcq .option .badge{font-size:12px;opacity:.9}
    .mcq .option.selected{outline:2px solid #475569}
    .mcq .option.correct{border-color:var(--good);box-shadow:0 0 0 2px rgba(34,197,94,.2) inset}
    .mcq .option.wrong{border-color:var(--bad);box-shadow:0 0 0 2px rgba(239,68,68,.25) inset}
    .mcq.locked .option{pointer-events:none;opacity:.95}
    /* Inputs */
    input[type="text"]{padding:10px;border-radius:10px;border:1px solid #334155;background:#0b0f1f;color:#fff;width:100%}
    .inline-status{font-size:12px;margin-top:4px}
    /* Builder */
    .swim{display:flex;flex-wrap:wrap;gap:10px}
    .chip.solid{background:#0b1227;border-color:#42526b}
    .chip.sel{box-shadow:0 0 0 2px #0ea5b8 inset}
    .preview{font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace;background:#0a0f20;border:1px solid #1f2937;border-radius:10px;padding:10px;color:#d1d5db}
  </style>
</head>
<body>
  <header>
    <h1>Samestellende Afleiding</h1>
    <span class="tag">Graad 8 ‚Ä¢ Afrikaans FAL ‚Ä¢ CAPS</span>
    <div style="margin-left:auto;display:flex;gap:10px;align-items:center;flex-wrap:wrap">
      <div class="kpi" title="Punte"><span>‚≠ê</span><span id="score">0</span></div>
      <div class="kpi" title="Voltooi"><span>‚úÖ</span><span id="done">0</span>/5</div>
      <button class="btn" id="muteBtn" title="Skakel klank aan/af">üîä Sound On</button>
      <button class="btn" id="resetBtn">Herstel</button>
    </div>
  </header>

  <main id="app">
    <div class="nav">
      <button data-tab="les" class="active">Les</button>
      <button data-tab="sleep">Sleep & Los</button>
      <button data-tab="mcq">Meerkeuse</button>
      <button data-tab="bou">Bou-‚Äôn-woord</button>
      <button data-tab="kort">Kort antwoorde</button>
      <button data-tab="toets">Eindtoets</button>
      <button data-tab="result">Resultate</button>
    </div>

    <!-- LES -->
    <section id="tab-les" class="card">
      <h2>Wat is <span class="hl">samestellende afleiding</span>?</h2>
      <p>‚Äôn <b>Samestellende afleiding</b> is ‚Äôn woord wat deur <b>samestelling</b> (woorde saamvoeg) √©n <b>afleiding</b> (voor-/agtervoegsel) gevorm word.</p>
      <div class="grid cols-2">
        <div>
          <p class="pill">Struktuur</p>
          <ul class="small">
            <li>Woord 1 + Woord 2 = <i>samestelling</i></li>
            <li>Voeg voor-/agtervoegsel by = <i>afleiding</i></li>
          </ul>
          <p class="hint"><i>English: First make a compound, then add a prefix/suffix to derive a new word.</i></p>
        </div>
        <div>
          <p class="pill">Voorbeelde</p>
          <ul class="small">
            <li><b>skool</b> + <b>meisie</b> + <b>tjie</b> ‚Üí skoolmeisietjie</li>
            <li><b>motor</b> + <b>bestuurder</b> + <b>s</b> ‚Üí motorbestuurders</li>
            <li><b>boek</b> + <b>rak</b> + <b>kie</b> ‚Üí boekrakkie</li>
          </ul>
        </div>
      </div>
      <div class="sep"></div>
      <h3>Belangrike wenke</h3>
      <ul class="small">
        <li>Ontleed eers die <b>basis-samestelling</b>, daarna die <b>afleidingsmorfeem</b>.</li>
        <li>Afleidings kan kleinheid (-tjie/-ie), meervoud (-e/-s) of nuwe woordsoort/ betekenis (-lik/-heid) aandui.</li>
      </ul>
      <p class="hint"><i>English: Look for the core compound first; then see what suffix/prefix was added.</i></p>
    </section>

    <!-- DRAG & DROP -->
    <section id="tab-sleep" class="card" hidden>
      <h2>Sleep & los: Is dit ‚Äôn Samestellende Afleiding?</h2>
      <p class="muted">Plaas in die korrekte emmer (JA/NEE). <span class="hint"><i>English: Drag to Yes or No.</i></span></p>
      <div class="dragbank" id="dragBank"></div>
      <div class="grid cols-2 buckets" id="buckets"></div>
      <div style="display:flex;gap:10px;align-items:center;margin-top:12px">
        <button class="btn primary" id="checkDrag">Merk</button>
        <button class="btn" id="resetDrag">Herbegin</button>
        <span id="dragMsg" class="muted"></span>
      </div>
    </section>

    <!-- MCQ -->
    <section id="tab-mcq" class="card" hidden>
      <h2>Meerkeuse</h2>
      <p class="muted">Kies die beste opsie. Antwoord **vergrendel** na jou keuse en jy kry dadelik terugvoer. <span class="hint"><i>English: Immediate feedback; answer locks.</i></span></p>
      <div id="mcqProg" class="small muted" style="margin:.3rem 0 .6rem"></div>
      <div id="mcqWrap"></div>
      <div style="display:flex;gap:10px;align-items:center;margin-top:12px">
        <button class="btn" id="resetMcq">Herbegin</button>
        <span id="mcqMsg" class="muted"></span>
      </div>
    </section>

    <!-- BUILDER -->
    <section id="tab-bou" class="card" hidden>
      <h2>Bou-‚Äôn-woord</h2>
      <p class="muted">Bou die <b>teikenwoord</b> deur die regte voor-/agtervoegsel by die <b>basis-samestelling</b> te voeg.</p>
      <p class="hint"><i>English: Build the goal word by adding the correct suffix or prefix to the base compound.</i></p>

      <div class="sep"></div>
      <div id="challengeMeta" class="small"></div>

      <h3>1) Basis-samestelling</h3>
      <div id="baseBank" class="swim" style="margin-bottom:8px"></div>

      <h3>2) Voorvoegsels (opsioneel)</h3>
      <div id="preBank" class="swim" style="margin-bottom:8px"></div>

      <h3>3) Agtervoegsels</h3>
      <div id="sufBank" class="swim" style="margin-bottom:8px"></div>

      <h3>Voorskou</h3>
      <div id="preview" class="preview">‚Äî</div>

      <div style="display:flex;gap:10px;align-items:center;margin-top:12px">
        <button class="btn primary" id="checkBuild">Merk</button>
        <button class="btn" id="resetBuild">Herbegin</button>
        <button class="btn" id="nextBuild">Volgende</button>
        <span id="buildMsg" class="muted"></span>
      </div>
    </section>

    <!-- SHORT ANSWERS -->
    <section id="tab-kort" class="card" hidden>
      <h2>Kort antwoorde</h2>
      <p class="muted">Tik die korrekte ontleding of voorbeeld. <b>Onmiddellike terugvoer</b> as jy klaar tik of fokus verloor.</p>
      <div id="shortWrap"></div>
      <div id="shortProg" class="small muted" style="margin:.3rem 0 .6rem"></div>
      <div style="display:flex;gap:10px;align-items:center;margin-top:12px">
        <button class="btn" id="resetShort">Herbegin</button>
        <span id="shortMsg" class="muted"></span>
      </div>
    </section>

    <!-- FINAL QUIZ -->
    <section id="tab-toets" class="card" hidden>
      <h2>Eindtoets</h2>
      <p class="muted">Gemengde vrae met onmiddellike terugvoer per vraag.</p>
      <div id="finalWrap"></div>
      <div id="finalProg" class="small muted" style="margin:.3rem 0 .6rem"></div>
      <div style="display:flex;gap:10px;align-items:center;margin-top:12px">
        <button class="btn" id="resetFinal">Herbegin</button>
        <span id="finalMsg" class="muted"></span>
      </div>
    </section>

    <!-- RESULTS -->
    <section id="tab-result" class="card" hidden>
      <h2>Resultate & vordering</h2>
      <div id="summary"></div>
      <div class="sep"></div>
      <p class="small">Wenk: Gaan terug na die ‚ÄúLes‚Äù-tab vir vinnige herhaling. <span class="hint"><i>English: Review and retry.</i></span></p>
    </section>
  </main>

  <footer>Created by Wordwise</footer>

  <script>
    // ---------- Audio + Mute ----------
    const AudioOK = window.AudioContext || window.webkitAudioContext;
    const LSKEY="safl_";
    let actx;
    let muted = localStorage.getItem(LSKEY+"mute")==="1";
    const muteBtn = document.getElementById("muteBtn");
    function updateMuteUI(){ muteBtn.textContent = muted ? "üîá Muted" : "üîä Sound On"; }
    updateMuteUI();
    muteBtn.addEventListener("click", ()=>{ muted=!muted; localStorage.setItem(LSKEY+"mute", muted?"1":"0"); updateMuteUI(); });
    function tone(freq=440,time=0.12,type="sine",vol=0.05){ if(muted||!AudioOK) return; if(!actx) actx=new AudioOK(); const o=actx.createOscillator(),g=actx.createGain(); o.type=type;o.frequency.value=freq; g.gain.value=vol; o.connect(g); g.connect(actx.destination); o.start(); g.gain.exponentialRampToValueAtTime(0.0001, actx.currentTime+time); o.stop(actx.currentTime+time); }
    const sfx={ click:()=>tone(420,0.05,"triangle",0.04), correct:()=>{tone(660,0.08,"sine",0.06); setTimeout(()=>tone(880,0.08,"sine",0.05),90);}, wrong:()=>{tone(180,0.08,"sawtooth",0.06); setTimeout(()=>tone(140,0.12,"sawtooth",0.05),80);}, success:()=>{[660,880,1040].forEach((f,i)=>setTimeout(()=>tone(f,0.09,"sine",0.07),i*120));} };
    document.addEventListener("click", e=>{ if(e.target.classList && (e.target.classList.contains("btn")||e.target.closest(".nav"))) sfx.click(); });

    // ---------- State ----------
    const state={ score:Number(localStorage.getItem(LSKEY+"score")||0), done:JSON.parse(localStorage.getItem(LSKEY+"done")||"{}") };
    const elScore=document.getElementById("score"), elDone=document.getElementById("done");
    function save(){ localStorage.setItem(LSKEY+"score",state.score); localStorage.setItem(LSKEY+"done",JSON.stringify(state.done)); elScore.textContent=state.score; elDone.textContent=Object.keys(state.done).length; } save();

    // ---------- Nav ----------
    const tabs=["les","sleep","mcq","bou","kort","toets","result"];
    document.querySelectorAll(".nav button").forEach(btn=>{
      btn.addEventListener("click",()=>{
        document.querySelectorAll(".nav button").forEach(b=>b.classList.remove("active")); btn.classList.add("active");
        const tab=btn.dataset.tab; tabs.forEach(t=>document.getElementById("tab-"+t).hidden=(t!==tab));
        if(tab==="result") renderSummary();
      });
    });
    document.getElementById("resetBtn").addEventListener("click",()=>{
      if(confirm("Herstel punte en vordering?")){ localStorage.removeItem(LSKEY+"score"); localStorage.removeItem(LSKEY+"done"); state.score=0; state.done={}; save(); location.reload(); }
    });

    // ---------- Drag & Drop (immediate feedback per drop) ----------
    const DRAG_ITEMS=[
      {w:"motorbestuurders",cat:"ja"},
      {w:"skoolmeisietjie",cat:"ja"},
      {w:"boekrak",cat:"nee"},
      {w:"ongelukkig",cat:"nee"},
      {w:"boekrakkie",cat:"ja"},
      {w:"hondhok",cat:"nee"},
      {w:"plaaswerker",cat:"nee"},
      {w:"plaaswerkertjie",cat:"ja"}
    ];
    const BUCKETS=["ja","nee"];
    const dragBank=document.getElementById("dragBank"), bucketsWrap=document.getElementById("buckets"), dragMsg=document.getElementById("dragMsg");
    function shuffle(a){for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]];}return a;}
    function renderDrag(){
      dragBank.innerHTML=""; bucketsWrap.innerHTML="";
      shuffle([...DRAG_ITEMS]).forEach((it,i)=>{
        const chip=document.createElement("div");
        chip.className="chip"; chip.textContent=it.w; chip.draggable=true; chip.id="chip-"+i; chip.dataset.cat=it.cat;
        const mark=document.createElement("span"); mark.className="mark"; mark.textContent=""; chip.appendChild(mark);
        chip.addEventListener("dragstart",e=>e.dataTransfer.setData("text/plain",chip.id));
        dragBank.appendChild(chip);
      });
      BUCKETS.forEach(cat=>{
        const b=document.createElement("div");
        b.className="bucket"; b.dataset.cat=cat;
        b.addEventListener("dragover",e=>e.preventDefault());
        b.addEventListener("drop",e=>{
          const id=e.dataTransfer.getData("text/plain"); const node=document.getElementById(id); b.appendChild(node); sfx.click();
          const correct=(node.dataset.cat===cat);
          node.classList.remove("good","bad");
          node.querySelector(".mark").textContent=correct?"‚úÖ":"‚ùå";
          node.classList.add(correct?"good":"bad");
          if(correct){ node.draggable=false; } // lock when correct
          updateDragProgress();
        });
        b.innerHTML=`<h4>${cat.toUpperCase()}</h4>`; bucketsWrap.appendChild(b);
      });
      dragMsg.textContent="";
    }
    function updateDragProgress(){
      const total=DRAG_ITEMS.length;
      const placedGood=[...document.querySelectorAll(".chip.good")].length;
      dragMsg.textContent=`Reg geplaas: ${placedGood}/${total}`;
      if(placedGood===total){ sfx.success(); if(!state.done.sleep){state.done.sleep=true; state.score+=10; save();} }
    }
    renderDrag();
    document.getElementById("resetDrag").addEventListener("click",renderDrag);
    document.getElementById("checkDrag").addEventListener("click",updateDragProgress); // still available

    // ---------- MCQ (immediate feedback + lock + progress) ----------
    const MCQ=[
      {q:"Watter een is ‚Äôn samestellende afleiding?", a:"motorbestuurders", d:["motorhuis","bestuurder","motors"]},
      {q:"Kies die korrekte ontleding vir ‚Äúboekrakkie‚Äù.", a:"boek + rak + kie", d:["boek + rak","boek + kie","rak + kie"]},
      {q:"‚Äôn Samestellende afleiding bestaan uit:", a:"Samestelling + Afleiding", d:["Afleiding + Afleiding","Samestelling + Samestelling","Net een basiswoord"]},
      {q:"Watter woord wys eers samestelling en dan verkleining?", a:"skoolmeisietjie", d:["meisie","skoolmeisie","meisietjie"]},
      {q:"Watter voorbeeld is NIE ‚Äôn samestellende afleiding nie?", a:"hondhok", d:["plaaswerkertjie","boekrakkie","motorbestuurders"]}
    ];
    const mcqWrap=document.getElementById("mcqWrap"), mcqMsg=document.getElementById("mcqMsg"), mcqProg=document.getElementById("mcqProg");
    function renderMcq(){
      mcqWrap.innerHTML=""; MCQ.forEach((m,i)=>{
        const box=document.createElement("div"); box.className="mcq"; box.dataset.index=i;
        box.innerHTML=`<div class="qhead"><p><b>${i+1}.</b> ${m.q}</p><span class="status muted"></span></div>`;
        const opts=shuffle([m.a,...m.d]);
        opts.forEach(op=>{
          const div=document.createElement("div"); div.className="option"; div.innerHTML=`<span>${op}</span><span class="badge"></span>`; div.dataset.correct=(op===m.a);
          div.addEventListener("click",()=>{
            if(box.classList.contains("locked")) return;
            [...box.querySelectorAll(".option")].forEach(o=>o.classList.remove("selected","correct","wrong"));
            div.classList.add("selected");
            const ok = div.dataset.correct==="true";
            if(ok){ div.classList.add("correct"); box.querySelector(".status").textContent="‚úÖ Reg"; div.querySelector(".badge").textContent="Gekies"; sfx.correct(); }
            else { div.classList.add("wrong"); box.querySelector(".status").textContent="‚ùå Verkeerd ‚Ä¢ Regte antwoord gemerk"; sfx.wrong(); box.querySelectorAll(".option").forEach(o=>{ if(o.dataset.correct==="true"){ o.classList.add("correct"); o.querySelector(".badge").textContent="Regte antwoord"; } }); }
            box.classList.add("locked"); // lock after answer
            updateMcqProgress();
          });
          box.appendChild(div);
        });
        mcqWrap.appendChild(box);
      });
      mcqMsg.textContent=""; updateMcqProgress();
    }
    function updateMcqProgress(){
      const total=MCQ.length;
      const locked=[...mcqWrap.querySelectorAll(".mcq.locked")].length;
      const allCorrect=locked===total && [...mcqWrap.querySelectorAll(".mcq")].every(b=>b.querySelector(".option.correct") && !b.querySelector(".option.wrong.selected"));
      mcqProg.textContent = `Beantwoord: ${locked}/${total}`;
      if(allCorrect && !state.done.mcq){ state.done.mcq=true; state.score+=10; save(); sfx.success(); mcqMsg.textContent="Alles reg beantwoord! ‚úÖ"; }
    }
    renderMcq();
    document.getElementById("resetMcq").addEventListener("click",renderMcq);

    // ---------- Builder (unchanged logic, keeps feedback) ----------
    const CHALLENGES=[
      {base:"skoolmeisie", goal:"skoolmeisietjie", allowedPrefixes:[], allowedSuffixes:["tjie"]},
      {base:"boekrak", goal:"boekrakkie", allowedPrefixes:[], allowedSuffixes:["kie"]},
      {base:"motorbestuurder", goal:"motorbestuurders", allowedPrefixes:[], allowedSuffixes:["s"]},
      {base:"houtkapper", goal:"houtkappers", allowedPrefixes:[], allowedSuffixes:["s"]},
      {base:"skoolbank", goal:"skoolbankie", allowedPrefixes:[], allowedSuffixes:["ie"]},
      {base:"skoolhoof", goal:"skoolhoofde", allowedPrefixes:[], allowedSuffixes:["de"]},
      {base:"fietsryer", goal:"fietsryers", allowedPrefixes:[], allowedSuffixes:["s"]},
      {base:"bergklimmer", goal:"bergklimmers", allowedPrefixes:[], allowedSuffixes:["s"]},
      {base:"waterbottel", goal:"waterbotteltjie", allowedPrefixes:[], allowedSuffixes:["tjie"]},
      {base:"klipbank", goal:"klipbankie", allowedPrefixes:[], allowedSuffixes:["ie"]}
    ];
    const PREFIXES=["on","be","ver","her","ge"], SUFFIXES=["tjie","ie","kie","s","e","lik","heid","de"];
    let chIndex=0, selBase=null, selPre=null, selSuf=null;
    const elMeta=document.getElementById("challengeMeta"), baseBank=document.getElementById("baseBank"), preBank=document.getElementById("preBank"), sufBank=document.getElementById("sufBank"), preview=document.getElementById("preview"), buildMsg=document.getElementById("buildMsg");
    function renderBuilder(){
      const ch=CHALLENGES[chIndex]; elMeta.innerHTML=`Uitdaging <b>${chIndex+1}</b> van <b>${CHALLENGES.length}</b> ‚Ä¢ Teikenwoord: <b>${ch.goal}</b>`;
      const decoys=["plaaswerker","skooltas","sonblom","boeksak"].filter(x=>x!==ch.base); const pool=shuffle([ch.base,...decoys]).slice(0,3);
      baseBank.innerHTML=""; pool.forEach(b=>{ const btn=document.createElement("div"); btn.className="chip solid"; btn.textContent=b; btn.addEventListener("click",()=>{ selBase=b; markSel(baseBank,btn); updatePreview(); sfx.click(); }); baseBank.appendChild(btn); });
      preBank.innerHTML=""; PREFIXES.forEach(p=>{ const btn=document.createElement("div"); btn.className="chip"; btn.textContent=p+"-"; btn.addEventListener("click",()=>{ selPre=(selPre===p?null:p); markSel(preBank, selPre?btn:null); updatePreview(); sfx.click(); }); preBank.appendChild(btn); });
      sufBank.innerHTML=""; SUFFIXES.forEach(s=>{ const btn=document.createElement("div"); btn.className="chip"; btn.textContent="-"+s; btn.addEventListener("click",()=>{ selSuf=(selSuf===s?null:s); markSel(sufBank, selSuf?btn:null); updatePreview(); sfx.click(); }); sufBank.appendChild(btn); });
      selBase=null; selPre=null; selSuf=null; updatePreview(); buildMsg.textContent=""; markSel(baseBank,null); markSel(preBank,null); markSel(sufBank,null);
    }
    function markSel(container,node){ [...container.children].forEach(c=>c.classList.remove("sel")); if(node) node.classList.add("sel"); }
    function buildWord(){ if(!selBase) return ""; return (selPre?selPre:"") + selBase + (selSuf?selSuf:""); }
    function updatePreview(){ const w=buildWord(); preview.textContent=w||"‚Äî"; }
    document.getElementById("resetBuild").addEventListener("click",()=>{ renderBuilder(); sfx.click(); });
    document.getElementById("checkBuild").addEventListener("click",()=>{ const ch=CHALLENGES[chIndex]; const w=buildWord(); if(!w){ buildMsg.textContent="Kies ‚Äôn basis en ‚Äôn agtervoegsel."; sfx.wrong(); return; } if(w.toLowerCase()===ch.goal.toLowerCase()){ buildMsg.textContent="Mooi! Reg gebou ‚úÖ"; sfx.success(); } else { buildMsg.textContent=`Nog nie reg nie. Probeer weer. (Jou woord: ${w})`; sfx.wrong(); } });
    document.getElementById("nextBuild").addEventListener("click",()=>{ const ch=CHALLENGES[chIndex]; const w=buildWord(); if(w.toLowerCase()!==ch.goal.toLowerCase()){ buildMsg.textContent="Merk eers die korrekte woord voordat jy voortgaan."; sfx.wrong(); return; } if(chIndex<CHALLENGES.length-1){ chIndex++; renderBuilder(); } else { buildMsg.textContent="Alle uitdagings voltooi! üéâ"; sfx.success(); if(!state.done.bou){ state.done.bou=true; state.score+=10; save(); } } });
    renderBuilder();

    // ---------- Short answers (immediate) ----------
    const SHORT=[
      {q:"Ontleed <b>skoolmeisietjie</b> (gebruik + tussen dele):", answers:["skool + meisie + tjie","skoolmeisie + tjie","skool + meisietjie"]},
      {q:"Gee <b>een</b> voorbeeld van ‚Äôn samestellende afleiding:", answers:["motorbestuurders","boekrakkie","skoolmeisietjie","plaaswerkertjie","skoolhoofde","fietsryers","bergklimmers","waterbotteltjie","klipbankie"]},
      {q:"Is <b>ongelukkig</b> ‚Äôn samestellende afleiding? Tik: ja/nee", answers:["nee","no"]},
      {q:"Vul in: <b>boek + rak + ?</b> ‚Üí boekrak____ (skryf die agtervoegsel):", answers:["kie"]},
      {q:"Benoem die <b>afleidingsdeel</b> in <b>motorbestuurders</b>:", answers:["s","-s"]}
    ];
    const shortWrap=document.getElementById("shortWrap"), shortMsg=document.getElementById("shortMsg"), shortProg=document.getElementById("shortProg");
    function renderShort(){
      shortWrap.innerHTML="";
      SHORT.forEach((s,i)=>{
        const row=document.createElement("div"); row.style.margin="10px 0";
        row.innerHTML = `<p>${i+1}. ${s.q}</p>
          <input data-i="${i}" type="text" placeholder="Jou antwoord" />
          <div class="inline-status muted"></div>`;
        const el=row.querySelector("input"); const status=row.querySelector(".inline-status");
        function validate(){ const ok = SHORT[i].answers.map(a=>a.toLowerCase().trim()).includes(el.value.toLowerCase().trim()); el.style.borderColor = ok ? "#22c55e" : (el.value? "#ef4444" : "#334155"); status.textContent = el.value ? (ok?"‚úÖ Reg":"‚ùå Probeer weer") : ""; if(ok) sfx.correct(); }
        el.addEventListener("blur", validate);
        el.addEventListener("change", validate);
        el.addEventListener("keyup", e=>{ if(e.key==="Enter") validate(); });
        shortWrap.appendChild(row);
      });
      shortMsg.textContent=""; updateShortProgress();
    }
    function updateShortProgress(){
      const total=SHORT.length;
      const answered=[...shortWrap.querySelectorAll("input")].filter(i=>i.value.trim()!=="").length;
      shortProg.textContent = `Beantwoord: ${answered}/${total}`;
      const allCorrect = [...shortWrap.querySelectorAll(".inline-status")].filter(s=>s.textContent.startsWith("‚úÖ")).length===total;
      if(allCorrect && !state.done.kort){ state.done.kort=true; state.score+=10; save(); sfx.success(); shortMsg.textContent="Alles reg! ‚úÖ"; }
    }
    renderShort();
    document.getElementById("resetShort").addEventListener("click",renderShort);
    shortWrap.addEventListener("input", updateShortProgress);

    // ---------- Final quiz (immediate per question) ----------
    const FINAL=[
      {type:"mcq", q:"Kies die beste voorbeeld van ‚Äôn samestellende afleiding:", a:"plaaswerkertjie", d:["plaaswerker","werktjie","plaas + werker"]},
      {type:"short", q:"Vul in: <b>hout + kap + er</b> ‚Üí ________", answers:["houtkapper"]},
      {type:"mcq", q:"Watter woord WYS eers samestelling, dan meervoud?", a:"motorbestuurders", d:["bestuurder","motorbestuurder","motors"]},
      {type:"short", q:"Ontleed <b>boekrakkie</b> (met +):", answers:["boek + rak + kie","boek + rak + ie"]},
      {type:"short", q:"Skryf JA of NEE: <b>hondhok</b> is ‚Äôn samestellende afleiding.", answers:["nee","no"]}
    ];
    const finalWrap=document.getElementById("finalWrap"), finalMsg=document.getElementById("finalMsg"), finalProg=document.getElementById("finalProg");
    function renderFinal(){
      finalWrap.innerHTML="";
      FINAL.forEach((f,idx)=>{
        if(f.type==="mcq"){
          const box=document.createElement("div"); box.className="mcq"; box.dataset.index=idx;
          box.innerHTML=`<div class="qhead"><p><b>${idx+1}.</b> ${f.q}</p><span class="status muted"></span></div>`;
          const opts=shuffle([f.a,...f.d]);
          opts.forEach(op=>{
            const div=document.createElement("div"); div.className="option"; div.innerHTML=`<span>${op}</span><span class="badge"></span>`; div.dataset.correct=(op===f.a);
            div.addEventListener("click",()=>{
              if(box.classList.contains("locked")) return;
              [...box.querySelectorAll(".option")].forEach(o=>o.classList.remove("selected","correct","wrong"));
              div.classList.add("selected");
              const ok = div.dataset.correct==="true";
              if(ok){ div.classList.add("correct"); box.querySelector(".status").textContent="‚úÖ Reg"; div.querySelector(".badge").textContent="Gekies"; sfx.correct(); }
              else { div.classList.add("wrong"); box.querySelector(".status").textContent="‚ùå Verkeerd ‚Ä¢ Regte antwoord gemerk"; sfx.wrong(); box.querySelectorAll(".option").forEach(o=>{ if(o.dataset.correct==="true"){ o.classList.add("correct"); o.querySelector(".badge").textContent="Regte antwoord"; } }); }
              box.classList.add("locked"); updateFinalProgress();
            });
            box.appendChild(div);
          });
          finalWrap.appendChild(box);
        } else {
          const row=document.createElement("div"); row.style.margin="10px 0";
          row.innerHTML = `<p><b>${idx+1}.</b> ${f.q}</p>
            <input type="text" data-answers='${JSON.stringify(f.answers)}' placeholder="Antwoord" />
            <div class="inline-status muted"></div>`;
          const el=row.querySelector("input"); const status=row.querySelector(".inline-status");
          function validate(){ const answers=JSON.parse(el.dataset.answers); const ok=answers.map(a=>a.toLowerCase().trim()).includes(el.value.toLowerCase().trim()); el.style.borderColor = ok ? "#22c55e" : (el.value? "#ef4444" : "#334155"); status.textContent = el.value ? (ok?"‚úÖ Reg":"‚ùå Probeer weer") : ""; if(ok) sfx.correct(); }
          el.addEventListener("blur", validate); el.addEventListener("change", validate); el.addEventListener("keyup", e=>{ if(e.key==="Enter") validate(); });
          finalWrap.appendChild(row);
        }
      });
      finalMsg.textContent=""; updateFinalProgress();
    }
    function updateFinalProgress(){
      const total=FINAL.length;
      const answeredMCQ=[...finalWrap.querySelectorAll(".mcq.locked")].length;
      const answeredShort=[...finalWrap.querySelectorAll(".inline-status")].filter(s=>s.textContent!=="").length - [...finalWrap.querySelectorAll(".mcq .status")].length;
      const answered=answeredMCQ + answeredShort;
      finalProg.textContent = `Beantwoord: ${answered}/${total}`;
      const allCorrect = [...finalWrap.querySelectorAll(".mcq")].every(b=>b.querySelector(".option.correct") && !b.querySelector(".option.wrong.selected")) &&
                         [...finalWrap.querySelectorAll("input[data-answers]")].every(el=>{
                           const answers=JSON.parse(el.dataset.answers); return answers.map(a=>a.toLowerCase().trim()).includes(el.value.toLowerCase().trim());
                         });
      if(allCorrect && !state.done.toets){ state.done.toets=true; state.score+=20; save(); sfx.success(); finalMsg.textContent="Alles reg! ‚úÖ"; }
    }
    renderFinal();
    document.getElementById("resetFinal").addEventListener("click",renderFinal);

    // ---------- Results ----------
    function renderSummary(){
      const s = `
        <div class="grid cols-2">
          <div class="card" style="background:#0a0f20">
            <h3>Jou punte</h3>
            <p class="kpi"><span>‚≠ê</span> <b>${state.score}</b> totale punte</p>
            <p class="muted small">+10 vir Sleep, +10 vir MCQ, +10 vir Bou-‚Äôn-woord, +10 vir Kort antwoorde, +20 vir Eindtoets.</p>
          </div>
          <div class="card" style="background:#0a0f20">
            <h3>Voltooiing</h3>
            <ul class="small">
              <li>Sleep & Los: ${state.done.sleep ? "‚úÖ" : "‚¨ú"}</li>
              <li>Meerkeuse: ${state.done.mcq ? "‚úÖ" : "‚¨ú"}</li>
              <li>Bou-‚Äôn-woord: ${state.done.bou ? "‚úÖ" : "‚¨ú"}</li>
              <li>Kort antwoorde: ${state.done.kort ? "‚úÖ" : "‚¨ú"}</li>
              <li>Eindtoets: ${state.done.toets ? "‚úÖ" : "‚¨ú"}</li>
            </ul>
          </div>
        </div>
      `;
      document.getElementById("summary").innerHTML = s;
    }
  </script>
</body>
</html>
